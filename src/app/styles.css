:root {
  color-scheme: light;
  --bg:#eceff3;
  --panel:#ffffff;
  --panel-soft:#f7f9fb;
  --ink:#111318;
  --muted:#68707a;
  --link:#2b5fd9;
  --chrome-top:#e0e3e8;
  --chrome-bottom:#cfd4db;
  --chrome-border:#b7bcc5;
  --input-bg:#ffffff;
  --input-border:#c8ced8;
  --chip-bg:rgba(255,255,255,0.95);
  --chip-border:#b7bcc5;
  --chip-danger-bg:rgba(255,0,0,0.12);
  --chip-danger-border:#d64545;
  --shadow:0 4px 18px rgba(0,0,0,0.08);
  --table-stripe:#f7f9fb;
  --table-sticky-shadow:-1px 0 0 rgba(0,0,0,0.05);
  --modal-shadow:0 20px 50px rgba(0,0,0,0.2);
  --score-chip-bg:rgba(255,255,255,0.85);
  --score-track:linear-gradient(90deg,#f05b5b 0%,#f0a95b 50%,#3fb573 100%);
  --score-dot-outline:#ffffff;
  --import-chip-bg:rgba(255,255,255,0.9);
  --import-chip-border:#b7bcc5;
}

html[data-theme='dark'] {
  color-scheme: dark;
  --bg:#15191f;
  --panel:#1f242b;
  --panel-soft:#252c34;
  --ink:#f1f4f8;
  --muted:#98a4b6;
  --link:#86a7ff;
  --chrome-top:#2b323d;
  --chrome-bottom:#222832;
  --chrome-border:#3a4452;
  --input-bg:#2b333d;
  --input-border:#3f4a5a;
  --chip-bg:rgba(43,51,63,0.92);
  --chip-border:#465267;
  --chip-danger-bg:rgba(181,64,64,0.18);
  --chip-danger-border:#f27d7d;
  --shadow:0 10px 30px rgba(0,0,0,0.5);
  --table-stripe:#222a34;
  --table-sticky-shadow:-1px 0 0 rgba(0,0,0,0.4);
  --modal-shadow:0 28px 70px rgba(0,0,0,0.6);
  --score-chip-bg:rgba(39,46,56,0.9);
  --score-track:linear-gradient(90deg,#f05b5b 0%,#f0a95b 50%,#3fb573 100%);
  --score-dot-outline:#1f242b;
  --import-chip-bg:rgba(37,43,52,0.92);
  --import-chip-border:#3f4a5a;
}

* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  margin: 0;
  font: 13px -apple-system,BlinkMacSystemFont,"Helvetica Neue",Helvetica,Arial,sans-serif;
  background: var(--bg);
  color: var(--ink);
  transition: background 0.25s ease, color 0.25s ease;
}

.wrap { max-width: 980px; margin: 18px auto; padding: 0 10px; }

/* Toolbar */
.toolbar.aqua {
  display: flex;
  align-items: center;
  gap: .5rem;
  padding: .5rem .6rem;
  background: linear-gradient(var(--chrome-top), var(--chrome-bottom));
  border: 1px solid var(--chrome-border);
  border-radius: 8px;
  box-shadow: 0 1px 0 rgba(255,255,255,0.3) inset;
}
.toolbar .title { font-weight: 800; }
.toolbtn {
  border: 1px solid var(--chrome-border);
  border-radius: 6px;
  background: var(--chip-bg);
  padding: .35rem .6rem;
  cursor: pointer;
  color: inherit;
}
.toolbtn.play { background: rgba(92,184,92,0.15); }
.sliderbox { display:flex; align-items:center; gap:.5rem; margin-left:.4rem; color:var(--muted); }
.sliderbox input { width: 140px; }
.spacer { flex: 1; }
.search {
  padding: .35rem .6rem;
  border: 1px solid var(--chrome-border);
  border-radius: 10px;
  width: 220px;
  background: var(--input-bg);
  color: var(--ink);
}

.top-toolbar { margin-bottom: 14px; }

.theme-toggle {
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 74px;
  height: 30px;
  border-radius: 999px;
  border: 1px solid var(--chrome-border);
  background: var(--chip-bg);
  cursor: pointer;
  padding: 0;
}
.theme-toggle input { display: none; }
.theme-toggle .track {
  position: relative;
  width: 100%;
  height: 100%;
  border-radius: 999px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 8px;
  font-size: 14px;
  color: var(--muted);
}
.theme-toggle .thumb {
  position: absolute;
  top: 3px;
  bottom: 3px;
  left: 3px;
  width: 32px;
  border-radius: 999px;
  background: var(--chrome-top);
  transition: transform .25s ease;
}
.theme-toggle input:checked + .track .thumb {
  transform: translateX(36px);
}
.theme-toggle .mode { pointer-events: none; }
.theme-toggle .mode--dark { margin-left: auto; }

/* Inputs */
input[type="text"],
input[type="number"],
input[type="search"],
select,
textarea {
  font: inherit;
  color: var(--ink);
}
input[type="text"],
input[type="number"],
select,
textarea {
  background: var(--input-bg);
  border: 1px solid var(--input-border);
  border-radius: 8px;
  padding: .35rem .45rem;
  transition: border-color .2s ease, box-shadow .2s ease;
}
input:focus,
select:focus,
textarea:focus {
  outline: none;
  border-color: var(--link);
  box-shadow: 0 0 0 2px rgba(43,95,217,0.15);
}

/* Boxed layouts */
.boxed {
  border: 1px solid var(--chrome-border);
  border-radius: 8px;
  background: var(--panel);
  box-shadow: var(--shadow);
  margin-top: 10px;
}
.table-scroll { overflow: auto; }
.table-grid { min-width: 720px; position: relative; }
.header,
.row {
  display: grid;
  grid-template-columns: 34px minmax(200px,2fr) minmax(200px,2fr) minmax(160px,1.1fr);
  align-items: center;
}
.header .th,
.row .td {
  padding: .45rem .6rem;
}
.header {
  background: linear-gradient(var(--chrome-top), var(--chrome-bottom));
  border-bottom: 1px solid var(--chrome-border);
  font-weight: 600;
  color: var(--ink);
}
.header .th.scol,
.row .td.scol { position: sticky; right: 0; }
.header .th.scol { z-index: 2; box-shadow: var(--table-sticky-shadow); }
.row .td.scol { z-index: 1; box-shadow: var(--table-sticky-shadow); background: var(--panel); }
.row:nth-child(odd) { background: var(--table-stripe); }
.row:nth-child(odd) .td.scol { background: var(--table-stripe); }
.row input[type="text"],
.row input[type="number"],
.row input:not([type]) {
  width: 100%;
}
.grid-4 { grid-template-columns: 34px minmax(200px,2fr) minmax(200px,2fr) minmax(160px,1.1fr); }

.table-spacer { height: 6px; background: transparent; }

.score-cell {
  display: flex;
  align-items: center;
  gap: .5rem;
  position: relative;
}
.score-chip {
  position: relative;
  display: inline-flex;
  align-items: center;
  gap: .5rem;
  padding: .3rem .65rem;
  border-radius: 999px;
  background: var(--score-chip-bg);
  border: 1px solid var(--chrome-border);
  cursor: pointer;
  user-select: none;
}
.score-chip__track {
  position: relative;
  width: 96px;
  height: 10px;
  border-radius: 999px;
  background: var(--score-track);
  overflow: hidden;
}
.score-chip__dot {
  position: absolute;
  top: 50%;
  left: var(--score-percent);
  transform: translate(-50%, -50%);
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: var(--score-color);
  box-shadow: 0 0 0 2px var(--score-dot-outline);
  transition: left .25s ease, background .25s ease;
}
.score-chip__value { font-weight: 600; min-width: 1.5rem; text-align: right; }

.score-edit {
  position: absolute;
  top: calc(100% + 6px);
  left: 0;
  background: var(--panel);
  border: 1px solid var(--chrome-border);
  border-radius: 8px;
  padding: .45rem .6rem;
  box-shadow: var(--shadow);
  display: flex;
  align-items: center;
  gap: .45rem;
  z-index: 4;
}
.score-edit input {
  width: 80px;
  padding: .35rem .4rem;
}
.score-edit__hint {
  font-size: .75rem;
  color: var(--muted);
}

.match-mode {
  display:flex;
  align-items:center;
  gap:.4rem;
  color:var(--muted);
}
.match-mode__label { font-weight:600; }
.match-mode select {
  min-width: 150px;
}

.footer {
  display:flex;
  gap:.6rem;
  align-items:center;
  padding:.5rem .6rem;
  background: var(--panel-soft);
  border-top:1px solid var(--chrome-border);
  border-bottom-left-radius:8px;
  border-bottom-right-radius:8px;
}
.chip {
  border:1px solid var(--chip-border);
  background:var(--chip-bg);
  border-radius:6px;
  padding:.25rem .6rem;
  cursor:pointer;
  color:inherit;
}
.chip--icon {
  font-size:1.1rem;
  width:34px;
  height:34px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
}
.chip--danger {
  border-color:var(--chip-danger-border);
  background:var(--chip-danger-bg);
  color:inherit;
}

.link-export {
  color: var(--link);
  text-decoration: none;
  font-weight: 600;
  padding: .35rem .25rem;
}
.link-export:hover { text-decoration: underline; }

.import-form {
  display:flex;
  align-items:center;
}
.file-chip {
  position:relative;
  border:1px dashed var(--import-chip-border);
  border-radius:8px;
  background:var(--import-chip-bg);
  padding:.4rem .75rem;
  font-weight:600;
  color:var(--muted);
  cursor:pointer;
  overflow:hidden;
}
.file-chip__label { pointer-events:none; }
.file-chip input[type="file"] {
  position:absolute;
  inset:0;
  opacity:0;
  cursor:pointer;
}

.page-header { display:flex; flex-direction:column; gap:.4rem; margin-bottom:12px; }
.back-link { text-decoration:none; color:var(--muted); font-weight:600; display:inline-flex; align-items:center; gap:.3rem; }
.back-link:hover { color:var(--ink); }
.deck-title { margin:0; font-size:1.6rem; font-weight:700; color:var(--ink); }

.deck-header { flex-direction:row; flex-wrap:wrap; align-items:center; gap:.75rem; }
.deck-title-form { display:flex; gap:.6rem; align-items:center; flex-wrap:wrap; }
.deck-title-input { min-width:220px; font-size:1rem; }

.chip--danger { border-color:var(--chip-danger-border); background:var(--chip-danger-bg); color:inherit; }

.page-header + .toolbar { margin-top:0; }

.pack-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:18px; margin-top:18px; }
.deck-card { display:flex; flex-direction:column; gap:1rem; padding:1.2rem; border-radius:16px; background:#111; color:#f7f7f7; text-decoration:none; box-shadow:0 12px 28px rgba(0,0,0,.25); transition:transform .2s ease, box-shadow .2s ease; min-height:160px; position:relative; }
html[data-theme='dark'] .deck-card { background:linear-gradient(145deg,#0d1015 0%,#151b23 100%); }
.deck-card:hover { transform:translateY(-4px); box-shadow:0 18px 34px rgba(0,0,0,.32); }
.deck-card__link { display:flex; flex-direction:column; gap:.6rem; color:inherit; text-decoration:none; flex:1; }
.deck-card__name { font-size:1.1rem; font-weight:600; }
.deck-card__meta { margin-top:auto; font-size:.85rem; color:rgba(255,255,255,.7); }
.deck-card--empty { background:rgba(17,17,17,.75); border:1px dashed rgba(255,255,255,.25); box-shadow:none; cursor:default; }
.deck-card--empty:hover { transform:none; box-shadow:none; }
.deck-card--create,.deck-card--manage { background:linear-gradient(145deg,#111 0%,#1c1c1c 35%,#050505 100%); }
.deck-card__form { display:flex; flex-direction:column; gap:.6rem; background:rgba(0,0,0,.35); padding:.8rem; border-radius:12px; }
.deck-card__form--danger { background:rgba(120,0,0,.35); }
.deck-card__field { display:flex; flex-direction:column; gap:.35rem; font-size:.8rem; color:rgba(255,255,255,.75); }
.deck-card__field input { padding:.5rem .7rem; border-radius:10px; border:1px solid rgba(255,255,255,.2); background:rgba(255,255,255,.12); color:#fff; }
.deck-card__field input::placeholder { color:rgba(255,255,255,.4); }
.deck-card__button { align-self:flex-start; padding:.45rem .9rem; border-radius:999px; border:1px solid rgba(255,255,255,.35); background:rgba(255,255,255,.16); color:#fff; font-weight:600; cursor:pointer; transition:background .2s ease,border-color .2s ease; }
.deck-card__button:hover { background:rgba(255,255,255,.24); border-color:rgba(255,255,255,.5); }
.deck-card__button--danger { border-color:rgba(255,0,0,.45); background:rgba(255,0,0,.22); }
.deck-card__button--danger:hover { background:rgba(255,0,0,.3); border-color:rgba(255,80,80,.7); }
.deck-card__rename { display:flex; flex-direction:column; gap:.8rem; }
.deck-card__rename summary { list-style:none; margin-left:auto; display:inline-flex; align-items:center; justify-content:center; width:34px; height:34px; border-radius:50%; border:1px solid rgba(255,255,255,.35); background:rgba(255,255,255,.16); cursor:pointer; color:#fff; transition:background .2s ease,border-color .2s ease; position:relative; }
.deck-card__rename summary:hover { background:rgba(255,255,255,.24); border-color:rgba(255,255,255,.5); }
.deck-card__rename summary::-webkit-details-marker { display:none; }
.deck-card__icon-button { font-size:0; }
.deck-card__icon-button span[aria-hidden="true"] { font-size:1rem; line-height:1; }
.sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0; }

.deck-footer { margin-top:16px; }

/* Study modal */
.screen { position:fixed; inset:0; background:rgba(0,0,0,.55); display:flex; align-items:center; justify-content:center; z-index:10; }
.modal { width:min(760px, 50vw); max-width:92vw; max-height:80vh; overflow:auto; border:1px solid var(--chrome-border); border-radius:8px; background:var(--panel); box-shadow:var(--modal-shadow); }
.modal-header { display:flex; align-items:center; padding:.6rem .8rem; background:linear-gradient(var(--chrome-top), var(--chrome-bottom)); border-bottom:1px solid var(--chrome-border); border-top-left-radius:8px; border-top-right-radius:8px; }
.modal .title { font-weight:700; }
.icon { border:1px solid var(--chrome-border); background:var(--chip-bg); border-radius:6px; width:28px; height:28px; cursor:pointer; color:inherit; }
.modal-body { padding:1rem 1rem 1.2rem; }
.cue { font-size:28px; font-weight:700; margin:.2rem 0 .6rem; text-align:left; }
.meta { color:var(--muted); margin-bottom:.6rem; }
.answer-block input { width:100%; padding:.6rem .7rem; border:1px solid var(--chrome-border); border-radius:8px; font-size:15px; background:var(--input-bg); color:var(--ink); }
.btn-row { display:flex; gap:.6rem; margin-top:.6rem; }
.revealed { margin-top:.8rem; }
.diff { white-space:pre-wrap; padding:.6rem .7rem; border:1px dashed var(--chrome-border); border-radius:6px; background:var(--panel-soft); font-family:ui-monospace,SFMono-Regular,Menlo,monospace; font-size:12px; margin-bottom:.5rem; }
.review-row { display:flex; align-items:center; gap:.6rem; margin-bottom:.6rem; }

@media (max-width:1040px) {
  .table-grid { min-width: 860px; }
}
@media (max-width:900px) {
  .table-grid { min-width: 760px; }
  .header,
  .row { grid-template-columns:34px minmax(180px,1.6fr) minmax(180px,1.6fr) minmax(140px,1fr); }
}
@media (max-width:760px) {
  .table-grid { min-width: 680px; }
  .header,
  .row { grid-template-columns:34px minmax(160px,1.4fr) minmax(160px,1.4fr) minmax(130px,1fr); }
  .score-chip__track { width: 84px; }
}
@media (max-width:768px) {
  .modal { width:100vw; height:100vh; max-height:none; border-radius:0; }
}
